个人物品分享系统 - 序列图文档
====================================

用户登录流程
============

用户           前端组件           状态管理          API客户端        后端控制器         业务服务        数据仓库         数据库
====         ============       ===========      ============      ============      ===========     ==========     =========

|                |                  |                 |                |               |            |
| 1. 用户输入    |                  |                 |                |               |            |
|    登录信息    |                  |                 |                |               |            |
|    (用户名/    |                  |                 |                |               |            |
|     密码)      |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 2. 表单验证      |                 |                |               |            |
|                |   - 输入格式检查  |                 |                |               |            |
|                |   - 必填项检查    |                 |                |               |            |
|                |   - 客户端验证    |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 3. 调用用户服务   |                 |                |               |            |
|                |   userService.   |                 |                |               |            |
|                |   login()        |                 |                |               |            |
|                +---------------->|                 |                |               |            |
|                |                  |                 |                |               |            |
|                |                  | 4. 更新loading  |                 |               |            |
|                |                  |   状态           |                 |               |            |
|                |                  |                 |                |               |            |
|                |                  | 5. HTTP POST    |                 |               |            |
|                |                  |   /auth/login   |                 |               |            |
|                |                  |   { username,   |                 |               |            |
|                |                  |    password }  |                 |               |            |
|                |                  +---------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 6. 用户控制器   |               |            |
|                |                  |                 |   UserController|              |            |
|                |                  |                 |   .login()     |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 7. 验证用户     |               |            |
|                |                  |                 |   - 查找用户    |               |            |
|                |                  |                 |   - 验证密码    |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |                 |                | 8. 查询用户   |            |
|                |                  |                 |                |   UserRepo.   |            |
|                |                  |                 |                |   findBy...   |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               | 9. SELECT  |
|                |                  |                 |                |               |   WHERE... |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |10. 返回    |
|                |                  |                 |                |               |   用户数据 |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |                |11. 密码验证   |            |
|                |                  |                 |                |   - 对比哈希   |            |
|                |                  |                 |                |   - 生成JWT    |            |
|                |                  |                 |                |               |            |
|                |                  |                 |12. 返回响应     |               |            |
|                |                  |                 |   { success,   |               |            |
|                |                  |                 |    token,      |               |            |
|                |                  |                 |    user }     |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |13. 收到响应     |                 |               |            |
|                |                  |   - 解析token   |                 |               |            |
|                |                  |   - 更新状态    |                 |               |            |
|                |                  |   - 存储令牌    |                 |               |            |
|                |                  +<----------------------------|            |            |
|                |                  |                 |                |               |            |
|                |14. 登录成功     |                 |                |               |            |
|                |   - 跳转到首页  |                 |                |               |            |
|                |   - 显示成功    |                 |                |               |            |
|                |     消息        |                 |                |               |            |
|<----------------+                 |                 |                |               |            |
|                |                  |                 |                |               |            |

物品发布流程
============

用户           前端组件           状态管理          API客户端        后端控制器         业务服务        数据仓库         数据库
====         ============       ===========      ============      ============      ===========     ==========     =========

|                |                  |                 |                |               |            |
| 1. 用户点击    |                  |                 |                |               |            |
|    "发布物品"  |                  |                 |                |               |            |
|    按钮        |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                | 2. 打开发布页面  |                 |                |               |            |
|                |   - 表单初始化   |                 |                |               |            |
|                |   - 文件上传     |                 |                |               |            |
|                |     组件加载     |                 |                |               |            |
|                |                  |                 |                |               |            |
| 3. 用户填写    |                  |                 |                |               |            |
|    物品信息    |                  |                 |                |               |            |
|    - 标题      |                  |                 |                |               |            |
|    - 描述      |                  |                 |                |               |            |
|    - 价格      |                  |                 |                |               |            |
|    - 分类      |                  |                 |                |               |            |
|    - 图片      |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                | 4. 表单验证      |                 |                |               |            |
|                |   - 必填项检查   |                 |                |               |            |
|                |   - 图片格式检查 |                 |                |               |            |
|                |   - 价格验证     |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 5. 图片上传      |                 |                |               |            |
|                |   - 文件选择     |                 |                |               |            |
|                |   - 压缩处理     |                 |                |               |            |
|                |   - 上传到CDN    |                 |                |               |            |
|                |     或服务器     |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 6. 调用物品服务  |                 |                |               |            |
|                |   itemService.   |                 |                |               |            |
|                |   createItem()   |                 |                |               |            |
|                +---------------->|                 |                |               |            |
|                |                  |                 |                |               |            |
|                |                  | 7. HTTP POST    |                 |               |            |
|                |                  |   /items        |                 |               |            |
|                |                  |   { title,      |                 |               |            |
|                |                  |    description, |                 |               |            |
|                |                  |    price,       |                 |               |            |
|                |                  |    categoryId,  |                 |               |            |
|                |                  |    images[] }  |                 |               |            |
|                |                  +---------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 8. 物品控制器   |               |            |
|                |                  |                 |   ItemController|              |            |
|                |                  |                 |   .create()    |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 9. 数据验证     |               |            |
|                |                  |                 |   - 用户权限    |               |            |
|                |                  |                 |   - 数据完整性  |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |10. 调用物品服务 |               |            |
|                |                  |                 |   ItemService  |               |            |
|                |                  |                 |   .create()    |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |                 |                |11. 保存物品   |            |
|                |                  |                 |                |   ItemRepo.   |            |
|                |                  |                 |                |   save()      |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |12. INSERT  |
|                |                  |                 |                |               |   INTO     |
|                |                  |                 |                |               |   items... |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |                |13. 保存图片   |            |
|                |                  |                 |                |   ImageRepo.  |            |
|                |                  |                 |                |   saveAll()   |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |14. INSERT  |
|                |                  |                 |                |               |   INTO     |
|                |                  |                 |                |               |   images...|
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |15. 返回物品     |               |            |
|                |                  |                 |   { success,   |               |            |
|                |                  |                 |    item }     |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |16. 收到响应     |                 |               |            |
|                |                  |   - 更新物品    |                 |               |            |
|                |                  |     列表        |                 |               |            |
|                |                  |   - 清除表单    |                 |               |            |
|                |                  |   - 跳转页面    |                 |               |            |
|                |                  +<----------------------------|            |            |
|                |                  |                 |                |               |            |
|                |17. 发布成功     |                 |                |               |            |
|                |   - 显示成功    |                 |                |               |            |
|                |     消息        |                 |                |               |            |
|                |   - 跳转首页    |                 |                |               |            |
|<----------------+                 |                 |                |               |            |
|                |                  |                 |                |               |            |

收藏功能流程序列图
==================

用户           前端组件           状态管理          API客户端        后端控制器         业务服务        数据仓库         数据库
====         ============       ===========      ============      ============      ===========     ==========     =========

|                |                  |                 |                |               |            |
| 1. 点击收藏     |                  |                 |                |               |            |
|    按钮        |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 2. 检查登录状态  |                 |                |               |            |
|                |   - 获取用户ID   |                 |                |               |            |
|                |   - 验证令牌     |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 3. 获取物品ID   |                 |                |               |            |
|                |   - 从路由参数   |                 |                |               |            |
|                |   - 或从列表项   |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 4. HTTP POST    |                 |                |               |            |
|                |   /favorites    |                 |                |               |            |
|                |   { itemId }   |                 |                |               |            |
|                +-------------------------------------------------->|                |            |
|                |                  |                 |                |               |            |
|                |                  | 5. 收藏控制器   |                 |               |            |
|                |                  |   FavoriteController|             |               |            |
|                |                  |   .add()      |                 |               |            |
|                |                  |                 |                |               |            |
|                |                  | 6. 调用服务     |                 |               |            |
|                |                  |   FavoriteService|              |               |            |
|                |                  |   .add()      |                 |               |            |
|                |                  +-------------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 7. 检查是否已收藏 |               |            |
|                |                  |                 |   - 查询用户     |               |            |
|                |                  |                 |     收藏记录     |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |                 |                |8. 查询收藏    |            |
|                |                  |                 |                |   FavoriteRepo|            |
|                |                  |                 |                |   .findBy...  |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |9. SELECT   |
|                |                  |                 |                |               |   FROM     |
|                |                  |                 |                |               |   favorites|
|                |                  |                 |                |               |   WHERE... |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |                |10. 如果未收藏  |            |
|                |                  |                 |                |   - 创建新记录 |            |
|                |                  |                 |                |   - 保存到数据库|            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |11. INSERT  |
|                |                  |                 |                |               |   INTO     |
|                |                  |                 |                |               |   favorites|
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |12. 更新收藏     |               |            |
|                |                  |                 |   数量统计     |               |            |
|                |                  |                 |   - 物品收藏数  |               |            |
|                |                  |                 |   - 用户收藏数  |               |            |
|                |                  |                 |               |               |            |
|                |                  |                 |13. 返回响应     |               |            |
|                |                  |                 |   { success,   |               |            |
|                |                  |                 |    favorited,  |               |            |
|                |                  |                 |    message }  |               |            |
|                |                  |                 +-------------------------------------------------->|
|                |                  |                 |                |               |            |
|                |14. 收到响应     |                 |                |               |            |
|                |   - 更新按钮    |                 |                |               |            |
|                |     状态        |                 |                |               |            |
|                |   - 更新UI      |                 |                |               |            |
|                |   - 显示反馈    |                 |                |               |            |
|<----------------+                 |                 |                |               |            |
|                |                  |                 |                |               |            |

物品浏览流程
============

用户           前端组件           状态管理          API客户端        后端控制器         业务服务        数据仓库         数据库
====         ============       ===========      ============      ============      ===========     ==========     =========

|                |                  |                 |                |               |            |
| 1. 访问首页    |                  |                 |                |               |            |
|    或物品列表  |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                | 2. 组件挂载      |                 |                |               |            |
|                |   - 初始化状态   |                 |                |               |            |
|                |   - 设置loading  |                 |                |               |            |
|                |     状态         |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 3. 获取分类列表  |                 |                |               |            |
|                |   - 调用分类服务 |                 |                |               |            |
|                |   categoryService|                 |                |               |            |
|                |   .getCategories()|                |                |               |            |
|                +---------------->|                 |                |               |            |
|                |                  |                 |                |               |            |
|                |                  | 4. HTTP GET     |                 |               |            |
|                |                  |   /categories   |                 |               |            |
|                |                  +---------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 5. 分类控制器   |               |            |
|                |                  |                 |   CategoryController|          |            |
|                |                  |                 |   .getAll()    |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 | 6. 调用分类服务 |               |            |
|                |                  |                 |   CategoryService|              |            |
|                |                  |                 |   .findAll()   |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |                 |                |7. 查询分类   |            |
|                |                  |                 |                |   CategoryRepo|            |
|                |                  |                 |                |   .findAll() |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |8. SELECT   |
|                |                  |                 |                |               |   FROM     |
|                |                  |                 |                |               |   categories|
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |9. 返回分类列表  |               |            |
|                |                  |                 |   { success,   |               |            |
|                |                  |                 |    data }     |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |10. 更新分类     |                 |               |            |
|                |                  |   状态          |                 |               |            |
|                |                  |   - 存储分类    |                 |               |            |
|                |                  |   - 更新UI      |                 |               |            |
|                |                  +<----------------------------|            |            |
|                |                  |                 |                |               |            |
|                |11. 获取物品列表  |                 |                |               |            |
|                |   - 默认参数     |                 |                |               |            |
|                |   - 搜索条件     |                 |                |               |            |
|                |   - 分页参数     |                 |                |               |            |
|                +---------------->|                 |                |               |            |
|                |                  |                 |                |               |            |
|                |                  |12. HTTP GET     |                 |               |            |
|                |                  |   /items        |                 |               |            |
|                |                  |   ?page=1&size=10|                |               |            |
|                |                  |   &categoryId=...|                |               |            |
|                |                  +---------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |13. 物品控制器   |               |            |
|                |                  |                 |   ItemController|              |            |
|                |                  |                 |   .getItems()  |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |14. 调用物品服务 |               |            |
|                |                  |                 |   ItemService  |               |            |
|                |                  |                 |   .findItems() |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |                 |                |15. 分页查询   |            |
|                |                  |                 |                |   ItemRepo.   |            |
|                |                  |                 |                |   findWith... |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |16. SELECT  |
|                |                  |                 |                |               |   FROM     |
|                |                  |                 |                |               |   items    |
|                |                  |                 |                |               |   JOIN...  |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |                |17. 获取关联   |            |
|                |                  |                 |                |   图片数据    |               |            |
|                |                  |                 |                +---------------------------->| 
|                |                  |                 |                |               |            |
|                |                  |                 |                |               |18. SELECT  |
|                |                  |                 |                |               |   FROM     |
|                |                  |                 |                |               |   images   |
|                |                  |                 |                |               +---------->|
|                |                  |                 |                |               |            |
|                |                  |                 |19. 返回物品列表  |               |            |
|                |                  |                 |   { success,   |               |            |
|                |                  |                 |    data: {     |               |            |
|                |                  |                 |      items,    |               |            |
|                |                  |                 |      total,    |               |            |
|                |                  |                 |      page }   |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |20. 更新物品     |                 |               |            |
|                |                  |   状态          |                 |               |            |
|                |                  |   - 存储物品    |                 |               |            |
|                |                  |   - 更新分页    |                 |               |            |
|                |                  |   - 清除loading |                 |               |            |
|                |                  +<----------------------------|            |            |
|                |                  |                 |                |               |            |
|                |21. 渲染物品列表  |                 |                |               |            |
|                |   - 显示物品卡片 |                 |                |               |            |
|                |   - 绑定事件     |                 |                |               |            |
|                |   - 分页组件     |                 |                |               |            |
|                |                  |                 |                |               |            |
|                |22. 页面渲染完成  |                 |                |               |            |
|                |   - 移除loading  |                 |                |               |            |
|                |   - 显示物品     |                 |                |               |            |
|                |   - 绑定交互    |                 |                |               |            |
|                |     事件         |                 |                |               |            |
|<----------------+                 |                 |                |               |            |
|                |                  |                 |                |               |            |

错误处理流程
============

用户           前端组件           状态管理          API客户端        后端控制器         业务服务        数据仓库         数据库
====         ============       ===========      ============      ============      ===========     ==========     =========

|                |                  |                 |                |               |            |
| 1. 发起请求    |                  |                 |                |               |            |
|    (任何操作)  |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                | 2. 设置loading   |                 |                |               |            |
|                |   状态           |                 |                |               |            |
|                +---------------->|                 |                |               |            |
|                |                  |                 |                |               |            |
|                |                  | 3. HTTP请求     |                 |               |            |
|                |                  |   (POST/GET/    |                 |               |            |
|                |                  |    PUT/DELETE)  |                 |               |            |
|                |                  +---------------------------->|               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |4. 后端处理     |               |            |
|                |                  |                 |   - 业务逻辑   |               |            |
|                |                  |                 |   - 数据验证   |               |            |
|                |                  |                 |   - 权限检查   |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |5. 发生错误     |               |            |
|                |                  |                 |   - 业务异常   |               |            |
|                |                  |                 |   - 系统异常   |               |            |
|                |                  |                 |   - 数据库错误 |               |            |
|                |                  |                 |                |               |            |
|                |                  |                 |6. 异常处理     |               |            |
|                |                  |                 |   - 记录日志   |               |            |
|                |                  |                 |   - 返回错误   |               |            |
|                |                  |                 |     响应       |               |            |
|                |                  |                 +---------------------------->|            |
|                |                  |                 |                |               |            |
|                |                  |7. 收到错误响应  |                 |               |            |
|                |                  |   - 解析响应    |                 |               |            |
|                |                  |   - 提取错误    |                 |               |            |
|                |                  |     消息        |                 |               |            |
|                |                  |   - 判断错误    |                 |               |            |
|                |                  |     类型        |                 |               |            |
|                |                  +<----------------------------|            |            |
|                |                  |                 |                |               |            |
|                |8. 更新错误状态   |                 |                |               |            |
|                |   - 设置error   |                 |                |               |            |
|                |     消息        |                 |                |               |            |
|                |   - 清除loading |                 |                |               |            |
|                |   - 更新UI      |                 |                |               |            |
|<----------------+                 |                 |                |               |            |
|                |                  |                 |                |               |            |
|                | 9. 显示错误信息  |                 |                |               |            |
|                |   - Toast提示   |                 |                |               |            |
|                |   - 错误对话框  |                 |                |               |            |
|                |   - 页面提示    |                 |                |               |            |
|                |   - 重试按钮    |                 |                |               |            |
|                |                  |                 |                |               |            |
| 10. 用户操作   |                  |                 |                |               |            |
|    - 查看错误  |                  |                 |                |               |            |
|    - 关闭提示  |                  |                 |                |               |            |
|    - 重试操作  |                  |                 |                |               |            |
|    - 返回上页  |                  |                 |                |               |            |
+-------------->|                  |                 |                |               |            |
|                | 11. 处理用户     |                 |                |               |            |
|                |    响应         |                 |                |               |            |
|                |    - 重试请求   |                 |                |               |            |
|                |    - 清理错误   |                 |                |               |            |
|                |    - 页面跳转   |                 |                |               |            |
|                |                  |                 |                |               |            |

常见错误类型处理:

1. 网络错误:
   - 显示"网络连接失败"
   - 提供重试按钮
   - 记录错误日志

2. 认证错误:
   - 清除本地token
   - 跳转到登录页
   - 显示"登录已过期"

3. 权限错误:
   - 显示"没有权限"
   - 隐藏/禁用相关功能
   - 记录访问尝试

4. 业务逻辑错误:
   - 显示具体错误信息
   - 提供解决方案
   - 记录错误详情

5. 服务器错误:
   - 显示"服务器繁忙"
   - 提供联系信息
   - 自动重试机制

6. 客户端错误:
   - 显示表单验证错误
   - 高亮错误字段
   - 提供正确格式示例